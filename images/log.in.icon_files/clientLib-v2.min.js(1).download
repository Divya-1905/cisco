/*! Let Us Help Right Rail (aka LUH EOT) version 1.5 */
/*
 * v1.5: JS Refactoring
 * v1.4: Refactored to use dm.onReady for initialisation
 * v1.3: Accessibility Enhancements and body scroll fix
 * v1.2: Added the floating functionality for partner
 * v1.1: Added the floating functionality
 * v1.0: Initialize using the height-match.js library.
 */

dm.onReady(() => {

    const hideContactBtnTxt = (luhFComp) => {
        // Run the callback
    	const scrollClass = 'scrl';
        const scrltp = window.pageYOffset || (document.documentElement || document.body.parentNode || document.body).scrollTop;

        if (scrltp > 100 && !luhFComp.classList.contains(scrollClass)) {
            luhFComp.classList.add(scrollClass);
        } else if(scrltp < 100 && luhFComp.classList.contains(scrollClass)) {
            luhFComp.classList.remove(scrollClass);
        }
    };

    dm.nmsp('dm.components.luhfloating');
    dm.components.luhfloating.init = () => {

        document.querySelectorAll('.dmc-letushelp-eot.floating:not(.initialized), .dmc-letushelp-eot-partner.floating:not(.initialized)').forEach(luhFComp => {

            hideContactBtnTxt(luhFComp);
            luhFComp.querySelector('.btn').addEventListener('click', () => {
                document.body.classList.add("luh-no-scroll");
            });
            luhFComp.querySelector('.cls').addEventListener('click', () => {
                document.body.classList.remove("luh-no-scroll");
            });

            // Listen for scroll events
            window.addEventListener('scroll', dm.debounce(() => {
            	hideContactBtnTxt(luhFComp);
            },300));
            
            //Accessibility for LUH, RR
            let guestLUH = document.getElementById('luhrr-menubutton');
            let guestLUHController;
            if (guestLUH) {
            	guestLUHController = new A11YMenuController(guestLUH, '.dmc-letushelp-eot.floating', '.dmc-letushelp-eot.floating .cls');
            	guestLUHController.init();
            }
            //Accessibility for LUH, RR - Partner
            let partnerLUH = document.getElementById('luhrrp-menubutton');
            let partnerLUHController;
            if (partnerLUH) {
            	partnerLUHController = new A11YMenuController(partnerLUH, '.dmc-letushelp-eot-partner.floating', '.dmc-letushelp-eot-partner.floating .cls');
            	partnerLUHController.init();
            }

            luhFComp.classList.add('initialized');
        });

    }
    //Initialize
    dm.components.luhfloating.init();

});