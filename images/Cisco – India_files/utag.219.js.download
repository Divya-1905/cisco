//tealium universal tag - utag.219 ut4.0.202105061949, Copyright 2021 Tealium.com Inc. All Rights Reserved.
var EloquaFormParser=function(queryString){var EMPTY="";var me=this;this.queryString=queryString;this.queryParams={"GCLID":{queryStrParamName:"gclid",elqaFormFieldName:"GCLID"},"ECID":{queryStrParamName:"ecid",elqaFormFieldName:"ECID"},"DTID":{queryStrParamName:"dtid",elqaFormFieldName:"DTID"},"CCID":{queryStrParamName:"ccid",elqaFormFieldName:"CCID"},"OID":{queryStrParamName:"oid",elqaFormFieldName:"OID"},"EID":{queryStrParamName:"eid",elqaFormFieldName:"EID"},"SEARCH":{queryStrParamName:"SEARCH",elqaFormFieldName:"search"},"CAMPAIGN":{queryStrParamName:"CAMPAIGN",elqaFormFieldName:"campaign"},"POSITION":{queryStrParamName:"POSITION",elqaFormFieldName:"position"},"COUNTRY_SITE":{queryStrParamName:"COUNTRY_SITE",elqaFormFieldName:"countrySite"},"CREATIVE":{queryStrParamName:"CREATIVE",elqaFormFieldName:"creative"},"REFERRING_SITE":{queryStrParamName:"REFERRING_SITE",elqaFormFieldName:"referringSite"},"KEYWORD":{queryStrParamName:"KEYWORD",elqaFormFieldName:"keywords"},"PLACEMENT":{queryStrParamName:"PLACEMENT",elqaFormFieldName:"placement"},"KEYCODE":{queryStrParamName:"keycode",elqaFormFieldName:"keycode1"},"AD_ID":{queryStrParamName:"ad_id",elqaFormFieldName:"adid"},"EMAILNAME":{queryStrParamName:"emailname",elqaFormFieldName:"emailName"},"BRDSFTLOGIN":{queryStrParamName:"BRDSFTLOGIN",elqaFormFieldName:"BRDSFTLOGIN"}};this.hiddenParams={"FORMID":{elqaFormFieldName:"FORMID"}};this.otherParams={"REFERRER":{elqaFormFieldName:"prevReferrer",dataLayerName:"dom.referrer"},"CPGUTC":{elqaFormFieldName:"CP_GUTC",dataLayerName:"cp.CP_GUTC"}};this.omsDataRequestArray=['oid','dtid','ccid','ecid','eid','keycode','gclid','search','placement','campaign','position','country_site','creative','keyword','referring_site','ad_id','emailname','brdsftlogin'];this.omsDataReturnArray=[];this.config={"debug":false,"debugQueryParameter":"debug","debugQueryValue":"elqa","leadingQuesMark":"?"};this.log=function(str){try{if(this.config.debug===true){console.log(str);}}catch(e){}};this.error=function(err){try{if(this.config.debug===true){console.error(err);}}catch(e){}};this.getDebugValue=function(dictionary){if(!dictionary){dictionary=this.parse();}
var debugParamValue=EMPTY;for(var key in dictionary){if(key.toLowerCase()===this.config.debugQueryParameter)debugParamValue=dictionary[key];}
return debugParamValue;};this.isDebuggerEnabled=function(dictionary){if(!dictionary){dictionary=this.parse();}
var debugParamValue=EMPTY;if(this.getDebugValue(dictionary)===this.config.debugQueryValue)return true;return false;};this.getHours=function(keyTimestamp,sysTimestamp){var currentTimestamp,delta,days,hours;if(!sysTimestamp){sysTimestamp=Math.round(Date.now()/(1000));}
currentTimestamp=sysTimestamp;delta=Math.abs(currentTimestamp-keyTimestamp);hours=Math.floor(delta/3600);this.log("Hours passed since last refresh: "+hours);return hours;};this.isOMSValDiscard=function(keyTimestamp,sysTimestamp){if(this.getHours(keyTimestamp,sysTimestamp)<24){this.log("Capture OMS Data : less than 24 hours old");return false;}
this.log("Discard OMS Data : more than 24 hours old");return true;};this.omsDataRequestCallback=function(data){try{me.log("in OMS call back",data);me.log("Getting OMS API Data from ctm.util.getOMS");var landingURLParameters=me.getKeys();var tokenDict=me.parse(me.queryString);var sysTimestamp;me.omsDataReturnArray=data;me.log("Data Returned by OMS API :");me.log(me.omsDataReturnArray);me.setElqaOMSData(me.omsDataReturnArray,me.omsDataRequestArray,sysTimestamp);me.log("Re-Setting Query String values");for(parameter in me.queryParams){if(me.queryParams.hasOwnProperty(parameter)){if(me.isParameterExist(landingURLParameters,me.queryParams[parameter].queryStrParamName)){me.setParamValueToFormField(tokenDict,me.queryParams[parameter].queryStrParamName,me.queryParams[parameter].elqaFormFieldName);}}}
me.setFormId();me.log("Re-Setting of Query String values SUCCESSFUL");me.log("ELQA Key Capturing SUCCESSFUL.");}catch(err){me.log("ELQA Key Capturing FAILED.");me.log("The following ERROR(s) occured:");me.error(err);console.log("Error occured while executing elqa-v1.js (ELQA Key Capturing Script).");}};this.getElqaOMSData=function(omsDataRequestArray,omsDataRequestCallback){if(!omsDataRequestArray){omsDataRequestArray=this.omsDataRequestArray;}
if(!omsDataRequestCallback){omsDataRequestCallback=this.omsDataRequestCallback;}
if((typeof ctmsRequire!="undefined")&&(ctmsRequire.require.specified('ctmsUtil'))){ctmsRequire.require(["ctmsUtil"],function(util){me.log("ctm loaded");me.log("util.getOMS function is defined");util.getOMS(omsDataRequestArray,omsDataRequestCallback);})}else{this.log("ctm not loaded yet");this.log("ctm.util.getOMS function Does Not Exist");}};this.setElqaOMSData=function(omsDataReturnArray,omsDataRequestArray,sysTimestamp){if(!omsDataReturnArray){omsDataReturnArray=this.omsDataReturnArray;}
if(!omsDataRequestArray){omsDataRequestArray=this.omsDataRequestArray;}
if(!sysTimestamp){sysTimestamp=Math.round(Date.now()/(1000));}
this.log("Setting OMS Data Values to Eloqua Form");var index,tokenIndex,tsKey;for(index=0;index<omsDataReturnArray.length;index+=1){for(key in omsDataReturnArray[index]){tsKey=key+'_ts';if(omsDataReturnArray[index].hasOwnProperty(key)){for(tokenIndex=0;tokenIndex<omsDataRequestArray.length;tokenIndex+=1){if((key.toLowerCase()===omsDataRequestArray[tokenIndex].toLowerCase())&&!this.isOMSValDiscard(omsDataReturnArray[index][tsKey],sysTimestamp)){this.log("Query String Parameter: "+this.queryParams[omsDataRequestArray[tokenIndex].toUpperCase()].queryStrParamName);this.setParamValueToFormField(omsDataReturnArray[index],this.queryParams[omsDataRequestArray[tokenIndex].toUpperCase()].queryStrParamName,this.queryParams[omsDataRequestArray[tokenIndex].toUpperCase()].elqaFormFieldName);break;}}}}}
this.log("Setting of OMS Data SUCCESSFUL");};this.parse=function(query){if(!query){query=this.queryString;}
this.log("Query to tokenize: "+query);var paramDict={},keyValuePair,parameters=query.split('&');parameters.forEach(function(parameter){keyValuePair=parameter.split('=');paramDict[keyValuePair[0]]=keyValuePair[1];});this.log("Query has been tokenized.");return paramDict;};this.getKeys=function(query){if(!query){query=this.queryString;}
var keys=[];var parameters=query.split('&');parameters.forEach(function(parameter,index){var keyValuePair=parameter.split('=');keys[index]=keyValuePair[0];});this.log("getKeys(): Created array of QueryString Parameter Names");return keys;};this.isParameterExist=function(keys,paramName){var index;for(index=0;index<keys.length;index+=1){if(keys[index].toLowerCase()===paramName.toLowerCase()){return true;}}
return false;};this.getParamterValue=function(dictionary,paramName){if(!dictionary){dictionary=this.parse();}
var paramValue=EMPTY,key=EMPTY;for(key in dictionary){if(dictionary.hasOwnProperty(key)){if(key.toLowerCase()===paramName.toLowerCase()){paramValue=dictionary[key];}}}
return paramValue;};this.setParamValueToFormField=function(dictionary,paramName,paramFormFieldName){if(!dictionary){dictionary=this.parse();}
var eloquaForm=document.forms[0];if(eloquaForm&&this.isELQAForm()&&eloquaForm.elements[paramFormFieldName]){this.log("Populating form field for "+paramName+" parameter");eloquaForm.elements[paramFormFieldName].value=this.getParamterValue(dictionary,paramName);}else{this.log("No form field found for "+paramName+" parameter");}};this.isELQAForm=function(){var pageForms=document.forms;var isElqaFormParamsExist=(document.querySelectorAll('[elqid]').length||document.querySelectorAll("input[name='elqFormName']").length||document.querySelectorAll("input[name='elqSiteId']").length);if(pageForms&&isElqaFormParamsExist){this.log("ELQA Form found on the page");return true;}else{this.log("No ELQA form found on the page");}
return false;};this.getFormID=function(){var formId=EMPTY;formId=document.forms[0].id;formId=formId.substring(4);return formId;};this.setFormId=function(){var formIdFormFieldName=EMPTY,eloquaForm;formIdFormFieldName=this.hiddenParams['FORMID'].elqaFormFieldName;eloquaForm=document.forms[0];if(eloquaForm&&this.isELQAForm()&&eloquaForm.elements[formIdFormFieldName]){this.log("Populating formID field");eloquaForm.elements[formIdFormFieldName].value=this.getFormID();}else{this.log("No formID field found");}};this.setOtherParams=function(){var formFieldName=EMPTY;var dataLayerName=EMPTY;var eloquaForm=document.forms[0];for(var i in this.otherParams){formFieldName=this.otherParams[i]["elqaFormFieldName"];dataLayerName=this.otherParams[i]["dataLayerName"];if(eloquaForm&&this.isELQAForm()&&eloquaForm.elements[formFieldName]){if(typeof utag.data[dataLayerName]!=="undefined"){eloquaForm.elements[formFieldName].value=utag.data[dataLayerName];}}}};this.init=function(){var parameter=null;if(!this.queryString){this.queryString=location.search;}
if(this.queryString.charAt(0)===this.config.leadingQuesMark){this.queryString=this.queryString.substring(1);}
this.queryString=decodeURIComponent(this.queryString);var landingURLParameters=this.getKeys();var tokenDict=this.parse(this.queryString);if(this.isDebuggerEnabled(tokenDict)){this.config.debug=true;this.log('elqa-v1.js : debugging enabled');}
this.log("Page Query String:"+this.queryString);try{this.log("ELQA Key Capturing ENABLED.");this.getElqaOMSData();this.log("Setting Query String values");for(parameter in this.queryParams){if(this.queryParams.hasOwnProperty(parameter)){if(this.isParameterExist(landingURLParameters,this.queryParams[parameter].queryStrParamName)){this.setParamValueToFormField(tokenDict,this.queryParams[parameter].queryStrParamName,this.queryParams[parameter].elqaFormFieldName);}}}
this.setOtherParams();this.setFormId();this.log("Setting of Query String values SUCCESSFUL");}catch(err){this.log("ELQA Key Capturing FAILED.");this.log("The following ERROR(s) occured:");this.error(err);console.log("Error occured while executing elqa-v1.js (ELQA Key Capturing Script).");}};};(function(){try{var elqFormParserObj=new EloquaFormParser();elqFormParserObj.init();}catch(err){console.log("Tealium Custom Tag: Error in parsing and updating OMS data in Eloqua form",err);}})();try{(function(id,loader){var u={};utag.o[loader].sender[id]=u;if(utag===undefined){utag={};}if(utag.ut===undefined){utag.ut={};}if(utag.ut.loader===undefined){u.loader=function(o){var a,b,c,l;a=document;if(o.type==="iframe"){b=a.createElement("iframe");b.setAttribute("height","1");b.setAttribute("width","1");b.setAttribute("style","display:none");b.setAttribute("src",o.src);}else if(o.type==="img"){utag.DB("Attach img: "+o.src);b=new Image();b.src=o.src;return;}else{b=a.createElement("script");b.language="javascript";b.type="text/javascript";b.async=1;b.charset="utf-8";b.src=o.src;}if(o.id){b.id=o.id;}if(typeof o.cb==="function"){if(b.addEventListener){b.addEventListener("load",function(){o.cb();},false);}else{b.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded"){this.onreadystatechange=null;o.cb();}};}}l=o.loc||"head";c=a.getElementsByTagName(l)[0];if(c){utag.DB("Attach to "+l+": "+o.src);if(l==="script"){c.parentNode.insertBefore(b,c);}else{c.appendChild(b);}}};}else{u.loader=utag.ut.loader;}
u.ev={'view':1};u.initialized=false;u.map={};u.extend=[];u.send=function(a,b){if(u.ev[a]||u.ev.all!==undefined){var c,d,e,f,i;u.data={};for(d in utag.loader.GV(u.map)){if(b[d]!==undefined&&b[d]!==""){e=u.map[d].split(",");for(f=0;f<e.length;f++){u.data[e[f]]=b[d];}}}
}};utag.o[loader].loader.LOAD(id);})("219","cisco.home");}catch(error){utag.DB(error);}
